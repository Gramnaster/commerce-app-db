json.status do
  json.code 200
  json.message "Fetched all social programs-receipts associations successfully"
end

json.pagination @pagination if @pagination

json.data do
  json.array! @social_program_receipts do |spc|
    json.id spc.id

    json.social_program do
      json.id spc.social_program.id
      json.title spc.social_program.title
      json.description spc.social_program.description

      json.address do
        json.id spc.address.id
        json.unit_no spc.address.unit_no
        json.street_no spc.address.street_no
        json.address_line1 spc.address.address_line1
        json.address_line2 spc.address.address_line2
        json.barangay spc.address.barangay
        json.city spc.address.city
        json.region spc.address.region
        json.zipcode spc.address.zipcode
        json.country_id spc.address.country_id
        json.country spc.address.country.name if spc.address.country
      end
    end

    json.receipt do
      json.id spc.receipt.id
      json.transaction_type spc.receipt.transaction_type
      json.amount spc.receipt.amount.to_f
      json.balance_before spc.receipt.balance_before.to_f
      json.balance_after spc.receipt.balance_after.to_f
      json.description spc.receipt.description
      json.created_at spc.receipt.created_at
      json.updated_at spc.receipt.updated_at

      json.user do
        json.id spc.receipt.user.id
        json.email spc.receipt.user.email
        json.first_name spc.receipt.user.user_detail&.first_name
        json.last_name spc.receipt.user.user_detail&.last_name
      end

      if spc.receipt.user_cart_order.present?
        json.order do
          json.id spc.receipt.user_cart_order.id
          json.cart_status spc.receipt.user_cart_order.cart_status
          json.is_paid spc.receipt.user_cart_order.is_paid
          json.total_cost spc.receipt.user_cart_order.total_cost.to_f

          # Order items summary
          json.items_count spc.receipt.user_cart_order.shopping_cart.shopping_cart_items.count
          json.total_quantity spc.receipt.user_cart_order.shopping_cart.shopping_cart_items.sum(:qty)
        end
      else
        json.order nil
      end
    end

    json.created_at spc.created_at
    json.updated_at spc.updated_at
  end
end
